<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Global</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Global</h1>

    




<section>

<header>
    
        <h2></h2>
        
    
</header>

<article>
    <div class="container-overview">
    
        

        


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>


        
    
    </div>

    

    

    

    

    

    

    

    
        <h3 class="subsection-title">Methods</h3>

        
            

    

    
    <h4 class="name" id="assembleMessage"><span class="type-signature"></span>assembleMessage<span class="signature">(messageDetails)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    This function assembles user messages into a persistable object. It accepts a messageDetails object as its only argument.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>messageDetails</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">An object containing the message details. This object contains the following properties:</td>
        </tr>

    
    </tbody>
</table>






    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>messageId</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">The message's id.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>messageTitle</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">The message's title.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>messagePriority</code></td>
            

            <td class="type">
            
                
<span class="param-type">Number</span>


            
            </td>

            

            

            <td class="description last">The message's priority (ranging from 0 to 10, with 0 being the lowest and q0 being the highest priority)</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>display</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">An object conataining additional icons to display within the message, e.g. { type: 'MODAL', iconType: 'SMILEY_FACE' }</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>creationTime</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">The message's creation time.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>hasFollowingMessage</code></td>
            

            <td class="type">
            
                
<span class="param-type">Boolean</span>


            
            </td>

            

            

            <td class="description last">a boolean value indicating whether the current message other message following it.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>followsPriorMessage</code></td>
            

            <td class="type">
            
                
<span class="param-type">Boolean</span>


            
            </td>

            

            

            <td class="description last">A boolean value indicating whether the current message follows other messages.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>actionContext</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">An object containing optional actions to be run during message assembly. For example { triggerBalanceFetch: true, boostId: '61af5b66-ad7a...' }</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>messageSequence</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">An object containing details such as messages to display on the success of the current message. An example object: { msgOnSuccess: '61af5b66-ad7a...' }</td>
        </tr>

    
    </tbody>
</table>




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="message-picking-handler.js.html">message-picking-handler.js</a>, <a href="message-picking-handler.js.html#line154">line 154</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="createFromPendingInstructions"><span class="type-signature"></span>createFromPendingInstructions<span class="signature">()</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    This runs on a scheduled job. It processes any once off and recurring instructions that have not been processed yet.
</div>













<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="message-creating-handler.js.html">message-creating-handler.js</a>, <a href="message-creating-handler.js.html#line259">line 259</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="createPersistableObject"><span class="type-signature"></span>createPersistableObject<span class="signature">(presentationType, audienceType, defaultTemplate, otherTemplates, selectionInstruction, recurrenceParameters, eventTypeCategory)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    todo : validate templates
This function takes the instruction passed by the caller, assigns it an instruction id, activates it,
and assigns default values where none are provided by the input object. Minimum required instruction properties are described below:
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>presentationType</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">Required. How the message should be presented. Valid values are RECURRING, ONCE_OFF and EVENT_DRIVEN.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>audienceType</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">Required. Defines the target audience. Valid values are INDIVIDUAL, GROUP, and ALL_USERS.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>defaultTemplate</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">Required when otherTemplates is null. Templates describe the message to be shown in the notification.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>otherTemplates</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">Required when defaultTemplate is null.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>selectionInstruction</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>


            
            </td>

            

            

            <td class="description last">Required when audience type is either INDIVIDUAL or GROUP.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>recurrenceParameters</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>


            
            </td>

            

            

            <td class="description last">Required when presentation type is RECURRING. Describes details like recurrence frequency, etc.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>eventTypeCategory</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">The event type and category for this instruction, controlled by caller's logic (e.g., REFERRAL::REDEEMED::REFERRER);</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="msg-instruction-handler.js.html">msg-instruction-handler.js</a>, <a href="msg-instruction-handler.js.html#line70">line 70</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="createUserMessages"><span class="type-signature"></span>createUserMessages<span class="signature">(instructions)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    A wrapper for simple instruction processing, although can handle multiple at once
note: this is only called for once off or event driven messages )i.e., invokes the above)
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>instructions</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array</span>


            
            </td>

            

            

            <td class="description last">An array of instruction identifier objects. Each instruction in the array may have the following properties:</td>
        </tr>

    
    </tbody>
</table>






    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>instructionId</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">The instruction id assigned during instruction creation.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>destinationUserId</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">Optional. This overrides the user ids indicated in the persisted message instruction's selectionInstruction property.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>parameters</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>


            
            </td>

            

            

            <td class="description last">Required when assembling boost message. Contains details such as boostAmount, which is inserted into the boost template.tr</td>
        </tr>

    
    </tbody>
</table>




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="message-creating-handler.js.html">message-creating-handler.js</a>, <a href="message-creating-handler.js.html#line207">line 207</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="deletePushToken"><span class="type-signature"></span>deletePushToken<span class="signature">(userId, provider)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    This function accepts a token provider and its owners user id. It then searches for the associated persisted token object and deletes it from the 
database. As during insertion, only the tokens owner can execute this action. This is implemented through request context evaluation, where the userId
found within the requestContext object must much the value of the tokens owner user id.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>userId</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">The tokens owner user id.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>provider</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">The tokens provider.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="message-push-handler.js.html">message-push-handler.js</a>, <a href="message-push-handler.js.html#line63">line 63</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="fetchAndFillInNextMessage"><span class="type-signature"></span>fetchAndFillInNextMessage<span class="signature">(destinationUserId, withinFlowFromMsgId)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    The function fetches and fills in the next message in a sequence of messages.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>destinationUserId</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">The messages destination user id.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>withinFlowFromMsgId</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">The messageId of the last message in the sequence to be processed prior to the current one.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="message-picking-handler.js.html">message-picking-handler.js</a>, <a href="message-picking-handler.js.html#line250">line 250</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="getMessageInstruction"><span class="type-signature"></span>getMessageInstruction<span class="signature">(instructionId)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    This function accepts an instruction id and returns the associated message instruction from the database.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>instructionId</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">The message instruction ID assigned during instruction creation.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="msg-instruction-handler.js.html">msg-instruction-handler.js</a>, <a href="msg-instruction-handler.js.html#line221">line 221</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="getNextMessageForUser"><span class="type-signature"></span>getNextMessageForUser<span class="signature">(requestContext, queryStringParameters)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Wrapper for the above, based on token, i.e., direct fetch
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>requestContext</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">An object caontaining the callers id, roles, and permissions. The event will not be processed without a valid request context.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>queryStringParameters</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">This functions accepts an lambda event passed via query string parameters. The queryStringParameters object may have the following properties:</td>
        </tr>

    
    </tbody>
</table>






    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>gameDryRun</code></td>
            

            <td class="type">
            
                
<span class="param-type">Boolean</span>


            
            </td>

            

            

            <td class="description last">Set to true to run a dry run operation, else omit or set to false to run full function operations.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>anchorMessageId</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">If message is part of a sequence, this property contains the messageId of the last processed message in the sequence before the current one.</td>
        </tr>

    
    </tbody>
</table>




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="message-picking-handler.js.html">message-picking-handler.js</a>, <a href="message-picking-handler.js.html#line306">line 306</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="insertMessageInstruction"><span class="type-signature"></span>insertMessageInstruction<span class="signature">(instructionId, presentationType, active, audienceType, defaultTemplate, otherTemplates, selectionInstruction, recurrenceParameters, responseAction, responseContext, startTime, endTime, lastProcessedTime, messagePriority)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    This function accepts a new instruction, validates the instruction, then persists it. Depending on the instruction, either
the whole or a subset of properties described below may provided as input. 

Note on templates: They can construct linked series of messages for users, depending on the top-level key, which can be either
"template", or "sequence". If it template, then only one message is generated, if it is sequence, then multiple are, and are linked.
Template contains the following: at least one top-level key, DEFAULT. Other variants (e.g., for A/B testing), can be defined as 
other top-level keys (e.g., VARIANT_A or TREATMENT). Underneath that key comes the message definition proper, as follows:
{ title: 'title of the message', body: 'body of the message', display: { displayDict }, responseAction: { }, responseContext: { dict }} 

If the top-level key is sequence, then an array should follow. The first message in the array must be the opening message, and will be 
marked as hasFollowingMessage. All the others will be marked as followsPriorMessage. Each element of the array will be identical to 
that for a single template, as above, but will also include the key, "identifier". This will be used to construct the messageIdsDict
that will be sent with each of the messages, so that the app or any other consumers can follow the sequences. Note that it is important
to keep the two identifiers distinct here: one, embedded within the template, is an identifier within the sequence of messages, the other,
at top level, identifies across variants.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>instructionId</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">The instructions unique id, useful in persistence operations.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>presentationType</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">Required. How the message should be presented. Valid values are RECURRING, ONCE_OFF and EVENT_DRIVEN.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>active</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>


            
            </td>

            

            

            <td class="description last">Indicates whether the message is active or not.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>audienceType</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">Required. Defines the target audience. Valid values are INDIVIDUAL, GROUP, and ALL_USERS.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>defaultTemplate</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">Required when otherTemplates is null. Templates describe the message to be shown in the notification.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>otherTemplates</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">Required when defaultTemplate is null.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>selectionInstruction</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>


            
            </td>

            

            

            <td class="description last">Required when audience type is either INDIVIDUAL or GROUP.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>recurrenceParameters</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>


            
            </td>

            

            

            <td class="description last">Required when presentation type is RECURRING. Describes details like recurrence frequency, etc.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>responseAction</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">Valid values include VIEW_HISTORY and INITIATE_GAME.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>responseContext</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>


            
            </td>

            

            

            <td class="description last">An object that includes details such as the boost ID.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>startTime</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">A Postgresql compatible date string. This describes when this notification message should start being displayed. Default is right now.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>endTime</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">A Postgresql compatible date string. This describes when this notification message should stop being displayed. Default is the end of time.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>lastProcessedTime</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">This property is updated eah time the message instruction is processed.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>messagePriority</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>


            
            </td>

            

            

            <td class="description last">An integer describing the notifications priority level. O is the lowest priority (and the default where not provided by caller).</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="msg-instruction-handler.js.html">msg-instruction-handler.js</a>, <a href="msg-instruction-handler.js.html#line159">line 159</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="insertPushToken"><span class="type-signature"></span>insertPushToken<span class="signature">(userId, provider, token)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    This function inserts a push token object into RDS. It requires that the user calling this function also owns the token.
An evaluation of the requestContext is run prior to token manipulation. If request context evaluation fails access is forbidden.
Non standared propertied are ignored during the assembly of the persistable token object.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>userId</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">The push tokens owner.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>provider</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">The push tokens provider.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>token</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">The push token.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="message-push-handler.js.html">message-push-handler.js</a>, <a href="message-push-handler.js.html#line23">line 23</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="listActiveMessages"><span class="type-signature"></span>listActiveMessages<span class="signature">()</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    This function (which will only be available to users with the right roles/permissions) will list currently active messages,
i.e., those that are marked as active, and, optionally, those that still have messages unread by users
</div>













<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="msg-instruction-handler.js.html">msg-instruction-handler.js</a>, <a href="msg-instruction-handler.js.html#line247">line 247</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="placeParamsInTemplate"><span class="type-signature"></span>placeParamsInTemplate<span class="signature">(template, passedParameters)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    NOTE: This is only for custom params supplied with the message-creation event. System defined params should be left alone.
This function assembles the selected template and inserts relevent data where required.
todo : make sure this handles subparams on standard params (e.g., total_interest::since etc)
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>template</code></td>
            

            <td class="type">
            
                
<span class="param-type">*</span>


            
            </td>

            

            

            <td class="description last">The selected template.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>passedParameters</code></td>
            

            <td class="type">
            
                
<span class="param-type">*</span>


            
            </td>

            

            

            <td class="description last">Extra parameters sent with the callers request. If parameters contain known proporties such as parameters.boostAmount then the associated are executed.
With regards to boost amount it is extracted from request parameters and inserted into the boost template.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="message-creating-handler.js.html">message-creating-handler.js</a>, <a href="message-creating-handler.js.html#line46">line 46</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="processNonRecurringInstruction"><span class="type-signature">(async) </span>processNonRecurringInstruction<span class="signature">(instructionId, destinationUserId, parameters)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    This function accepts an instruction id, retrieves the associated instruction from persistence, assembles the user message, and finally
persists the assembled user message to RDS. The minimum required parameter that must be passed to this function is the instruction. Without
it the sun does not shine. Other properties may be included in the parameters, such as destinationId
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>instructionId</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">The instruction id assigned during instruction creation.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>destinationUserId</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">Optional. This overrides the user ids indicated in the persisted message instruction's selectionInstruction property.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>parameters</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>


            
            </td>

            

            

            <td class="description last">Required when assembling boost message. Contains details such as boostAmount, which is inserted into the boost template.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="message-creating-handler.js.html">message-creating-handler.js</a>, <a href="message-creating-handler.js.html#line171">line 171</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="updateInstruction"><span class="type-signature"></span>updateInstruction<span class="signature">(instructionId, updateValues)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    This function can be used to update various aspects of a message. Note that if it 
deactivates the message instruction, that will stop all future notifications from message instruction,
and removes existing ones from the fetch queue.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>instructionId</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">The message instruction ID assigned during instruction creation.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>updateValues</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>


            
            </td>

            

            

            <td class="description last">Key-values of properties to update (e.g., { active: false })</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="msg-instruction-handler.js.html">msg-instruction-handler.js</a>, <a href="msg-instruction-handler.js.html#line194">line 194</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="updateUserMessage"><span class="type-signature"></span>updateUserMessage<span class="signature">(requestContext, messageId, userAction)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Simple (ish) method for updating a message once it has been delivered, etc.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>requestContext</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last">An object caontaining the callers id, roles, and permissions. The event will not be processed without a valid request context.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>messageId</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">The messageId of the message to me updated.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>userAction</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">The value to update the message option with. Valid values in this context are FETCHED and DISMISSED.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="message-picking-handler.js.html">message-picking-handler.js</a>, <a href="message-picking-handler.js.html#line345">line 345</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="validateMessageInstruction"><span class="type-signature"></span>validateMessageInstruction<span class="signature">(instructionId, presentationType, active, audienceType, templates, selectionInstruction, recurrenceParameters, responseAction, responseContext, startTime, endTime, messagePriority)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Enforces instruction rules and ensures the message instruction is valid before it is persisted.
First it asserts whether all required properties are present in the instruction object. If so, then
condtional required properties are asserted. These are properties that are only required under certain condtions.
For example, if the message instruction has a recurring presentation then a recurrance instruction is required to
describe how frequently the notification should recur. The object properties recieved by this function are described below:
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>instructionId</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">The instruction unique id, useful in persistence operations.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>presentationType</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">Required. How the message should be presented. Valid values are RECURRING, ONCE_OFF and EVENT_DRIVEN.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>active</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>


            
            </td>

            

            

            <td class="description last">Indicates whether the message is active or not.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>audienceType</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">Required. Defines the target audience. Valid values are INDIVIDUAL, GROUP, and ALL_USERS.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>templates</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>


            
            </td>

            

            

            <td class="description last">Required. Message instruction must include at least one template, ie, the notification message to be displayed</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>selectionInstruction</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>


            
            </td>

            

            

            <td class="description last">Required when audience type is either INDIVIDUAL or GROUP.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>recurrenceParameters</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>


            
            </td>

            

            

            <td class="description last">Required when presentation type is RECURRING. Describes details like recurrence frequency, etc.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>responseAction</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">Valid values include VIEW_HISTORY and INITIATE_GAME.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>responseContext</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>


            
            </td>

            

            

            <td class="description last">An object that includes details such as the boost ID.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>startTime</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">A Postgresql compatible date string. This describes when this notification message should start being displayed. Default is right now.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>endTime</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">A Postgresql compatible date string. This describes when this notification message should stop being displayed. Default is the end of time.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>messagePriority</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>


            
            </td>

            

            

            <td class="description last">An integer describing the notifications priority level. O is the lowest priority (and the default where not provided by caller).</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="msg-instruction-handler.js.html">msg-instruction-handler.js</a>, <a href="msg-instruction-handler.js.html#line35">line 35</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
    

    

    
</article>

</section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#assembleMessage">assembleMessage</a></li><li><a href="global.html#createFromPendingInstructions">createFromPendingInstructions</a></li><li><a href="global.html#createPersistableObject">createPersistableObject</a></li><li><a href="global.html#createUserMessages">createUserMessages</a></li><li><a href="global.html#deletePushToken">deletePushToken</a></li><li><a href="global.html#fetchAndFillInNextMessage">fetchAndFillInNextMessage</a></li><li><a href="global.html#getMessageInstruction">getMessageInstruction</a></li><li><a href="global.html#getNextMessageForUser">getNextMessageForUser</a></li><li><a href="global.html#insertMessageInstruction">insertMessageInstruction</a></li><li><a href="global.html#insertPushToken">insertPushToken</a></li><li><a href="global.html#listActiveMessages">listActiveMessages</a></li><li><a href="global.html#placeParamsInTemplate">placeParamsInTemplate</a></li><li><a href="global.html#processNonRecurringInstruction">processNonRecurringInstruction</a></li><li><a href="global.html#updateInstruction">updateInstruction</a></li><li><a href="global.html#updateUserMessage">updateUserMessage</a></li><li><a href="global.html#validateMessageInstruction">validateMessageInstruction</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Sat Oct 05 2019 15:19:32 GMT+0200 (South Africa Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>